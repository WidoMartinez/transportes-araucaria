# AGENTS.md

## üí° Prop√≥sito

Este documento establece **reglas y convenciones obligatorias** para agentes que colaboren en este repositorio (p. ej., Codex en VS Code). Su objetivo es mantener coherencia t√©cnica, de estilo y de flujo de trabajo.

---

## üåê Idioma y documentaci√≥n

- **Todo lo que se documente debe estar en espa√±ol.**
- **Todos los comentarios en el c√≥digo deben estar en espa√±ol.**
- Mensajes de consola, logs, descripciones de PR, issues y notas t√©cnicas: **en espa√±ol**.

---

## üìö Documentaci√≥n Primero (Documentation First)

- **Consultar antes de actuar**: Antes de realizar cambios o preguntas, verificar si la respuesta existe en:
  - `DOCUMENTACION_MAESTRA.md`: Para arquitectura y gu√≠as generales.
  - `GUIA_SOLUCION_PROBLEMAS.md`: Para errores conocidos (500, migraciones, auth).
- **Mantener actualizada**: Si realizas cambios que afecten flujos de trabajo, arquitectura o soluci√≥n de problemas, **DEBES actualizar** la documentaci√≥n correspondiente.
- **Documentar cambios t√©cnicos**: Al implementar nuevas funcionalidades, es **OBLIGATORIO** actualizar `DOCUMENTACION_MAESTRA.md` (secci√≥n "Sistemas T√©cnicos Detallados") describiendo la l√≥gica implementada, endpoints creados y decisiones de arquitectura relevantes.
- **Evitar duplicidad**: No crear nuevos archivos de documentaci√≥n si se puede actualizar uno existente. Centralizar en la Documentaci√≥n Maestra.

---

## üì® Notificaciones y pagos

- **Sistema de notificaciones por correo electr√≥nico:** mantener **PHPMailer**. No reemplazar por otras librer√≠as sin autorizaci√≥n expl√≠cita.
- **Backend de pagos y dem√°s servicios**: se ejecutan en **Render.com**. No migrar ni modificar esta arquitectura sin aprobaci√≥n.

---

## üõ°Ô∏è Archivos y √°mbitos protegidos

- **Nunca eliminar**:
  - `.github/instructions/instrucciones.instructions.md`
  - `.github/copilot-instructions.md`
- Evitar renombrar o mover archivos bajo `.github/` salvo que se solicite expl√≠citamente.

---

## üêò PHP en Hostinger (edici√≥n permitida con reglas)

- **Se permite editar archivos `.php`.**
- **Regla de comentario obligatorio:** al modificar un archivo PHP, **agrega al inicio** del archivo (o del bloque modificado) un comentario indicando que **este archivo se sube manualmente a Hostinger**.
  - Ejemplo (PHP):
    ```php
    <?php
    // AVISO: Este archivo se despliega manualmente en Hostinger (frontend y PHP en Hostinger).
    // Cualquier cambio local debe subirse manualmente al servidor.
    ```
- **No automatizar el despliegue de archivos PHP** desde este repositorio salvo aprobaci√≥n expl√≠cita.
- **No introducir dependencias o rutas** que asuman un entorno distinto al de Hostinger sin validaci√≥n previa.

---

## üß≠ Pol√≠tica de edici√≥n y alcance de cambios

- Realizar cambios **m√≠nimos y acotados** al alcance de la solicitud.
- Mantener compatibilidad con la infraestructura actual (**Hostinger + Render.com + PHPMailer**).
- Antes de introducir dependencias, verificar si ya existe una soluci√≥n interna.
- Preferir configuraci√≥n y utilidades ya presentes en el repo.

---

## ‚úÖ Flujo de commits (confirmaci√≥n requerida)

- **Siempre preguntar si se necesita hacer un commit.**
- Si la respuesta es afirmativa, **sugerir un mensaje de commit en espa√±ol**, **abreviado y conciso**, en formato:
  - `tipo: resumen breve en espa√±ol`
  - Ejemplos de `tipo`: `feat`, `fix`, `docs`, `chore`, `refactor`, `test`, `ci`.
- Incluir, si corresponde, un cuerpo (opcional) de 1‚Äì2 l√≠neas con el ‚Äúpor qu√©‚Äù del cambio.
- **Nunca realizar commits sin confirmaci√≥n previa.**

> **Plantilla de mensaje de commit sugerido (ejemplo)**  
> `docs: alinear comentarios y documentaci√≥n al espa√±ol`
>
> Cuerpo opcional (si aplica):  
> `Ajusta comentarios y README para cumplir la pol√≠tica de idioma.`

---

## üîÄ Pull Requests (PR) en espa√±ol

- **Todos los PR deben generarse en espa√±ol (todos los campos posibles).**
- Plantilla sugerida para la descripci√≥n del PR:
  1. **Resumen breve:** ¬øQu√© cambia y por qu√©?
  2. **Tipo de cambio:** `feat | fix | docs | chore | refactor | test | ci`
  3. **Detalles t√©cnicos:** decisiones y consideraciones.
  4. **Impacto en infraestructura:** Render.com / Hostinger / PHPMailer (si aplica).
  5. **Pruebas realizadas:** comandos y resultados.
  6. **Checklist:**
     - [ ] No se eliminaron archivos protegidos en `.github/`
     - [ ] Documentaci√≥n y comentarios en espa√±ol
     - [ ] Se respeta PHPMailer y Render.com
     - [ ] Si hubo cambios en PHP, **archivo(s) comentado(s) con aviso de despliegue manual en Hostinger**
  7. **Notas de despliegue:** pasos si son necesarios.
  8. **Screenshots / evidencia (opcional)**

---

## üß™ Pruebas y validaci√≥n (si aplica)

- A√±adir o actualizar pruebas relevantes al cambio.
- Documentar c√≥mo reproducir localmente (comandos o pasos).
- No introducir _breaking changes_ sin aviso expl√≠cito.

---

## üîí Seguridad y datos sensibles

- No exponer secretos en c√≥digo, commits ni PR.
- Mantener variables sensibles en los mecanismos ya definidos (env/secret managers del proyecto).

---

## üö´ Acciones que NO debes realizar

- Eliminar los archivos protegidos listados en **Archivos y √°mbitos protegidos**.
- Migrar el sistema de notificaciones fuera de **PHPMailer**.
- Cambiar la plataforma de ejecuci√≥n del backend fuera de **Render.com**.
- Generar PR o commits en idioma distinto al espa√±ol.
- Automatizar despliegues a Hostinger sin aprobaci√≥n (los **PHP se suben manualmente**).

---

## üìù Estilo de c√≥digo y comentarios

- Comentarios claros, en espa√±ol, explicando _por qu√©_ y no solo _qu√©_.
- Seguir las gu√≠as de estilo del lenguaje correspondiente en este repo.
- Mantener consistencia con las convenciones existentes.

---

---

## üöê L√≥gica de Reservas y Veh√≠culos

- **Capacidad de Veh√≠culos**: El backend filtra estrictamente por capacidad (`capacidad >= pasajeros`).
- **Validaci√≥n Frontend**: 
  - Para grupos de 1-4 pasajeros, el flujo es est√°ndar.
  - Para grupos de 5-7 pasajeros, se requiere un veh√≠culo tipo "Van".
  - Si `/api/disponibilidad/verificar` retorna falso para >4 pasajeros, **SIEMPRE derivar a WhatsApp** usando `WhatsAppButton.jsx`. No intentar forzar la reserva sin validaci√≥n.
- **Panel Administrativo**: Mantener siempre el filtrado visual en `AdminReservas` para evitar asignar veh√≠culos peque√±os a grupos grandes.

---

## üìä Conversiones y Analytics

- **Robustez en el Monto**: Al implementar flujos de pago o redirecciones que activen eventos de conversi√≥n (Google Ads, Meta, etc.), **SIEMPRE asegurar que el monto (`amount`) se pase en la URL**, incluso en escenarios de error o fallback.
  - **Nunca confiar solo en la sesi√≥n del cliente** o en re-consultas que pueden fallar.
  - El backend debe recuperar el monto de la pasarela (Flow) y pasarlo expl√≠citamente al frontend.
- **Evitar Valor Cero**: Implementar l√≥gicas defensivas para que, si el monto no est√° disponible, se use un valor por defecto sensato en lugar de `0` (que invalida la conversi√≥n).
- **Par√°metros URL**: Usar siempre `amount`, `reserva_id` y `status` como est√°ndar para comunicar el estado del pago a la p√°gina de retorno.

---

## üß∞ Notas para agentes

- Antes de iniciar, **leer este AGENTS.md** y revisar `.github/` para pol√≠ticas adicionales.
- **CR√çTICO:** Siempre consultar `DOCUMENTACION_MAESTRA.md` y `GUIA_SOLUCION_PROBLEMAS.md` como contexto antes de proponer soluciones, especialmente ante errores de backend o despliegue.
- Cuando completes una tarea:
  1. **Pregunta si se requiere commit.**
  2. Si la respuesta es s√≠, **sugiere un mensaje de commit breve en espa√±ol** (ver formato).
  3. Ofrece crear un **PR en espa√±ol** usando la plantilla indicada.
